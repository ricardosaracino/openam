(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[11],{1535:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=r(19);var n=i(a);var l=r(1562);var s=i(l);function i(e){return e&&e.__esModule?e:{default:e}}s.default.HeaderCell.prototype.render=function(){this.$el.empty();var e=this.column,t=s.default.callByNeed(e.sortable(),e,this.collection),r;r=t?(0,n.default)("<a>").text(e.get("label")).append("<b class='sort-caret'></b>"):document.createTextNode(e.get("label"));this.$el.append(r);this.$el.attr("data-field",e.get("name"));this.$el.addClass(e.get("direction"));this.delegateEvents();return this};t.default=s.default},1546:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r(1552);var n=r(6);var l=y(n);var s=r(19);var i=y(s);var o=r(159);var u=y(o);var d=r(12);var c=y(d);var f=r(1535);var h=y(f);var p=r(560);var v=y(p);var m=r(73);var g=y(m);function y(e){return e&&e.__esModule?e:{default:e}}var b={};b.DatetimeAgoCell=h.default.Cell.extend({className:"date-time-ago-cell",formatter:{fromRaw:function e(t){return(0,c.default)(t).fromNow()}},render:function e(){b.DatetimeAgoCell.__super__.render.apply(this);this.$el.attr("title",(0,c.default)(this.model.get(this.column.get("name"))).format("Do MMMM YYYY, h:mm:ssa"));return this}});b.ArrayCell=h.default.Cell.extend({className:"array-formatter-cell",buildHtml:function e(t){var r="<ul>",a=0;for(;a<t.length;a++)l.default.isString(t[a])?r+="<li>"+t[a]+"</li>":r+="<li>"+JSON.stringify(t[a])+"</li>";r+="</ul>";return r},render:function e(){this.$el.empty();var t=this.model.get(this.column.attributes.name);this.$el.append(this.buildHtml(t));this.delegateEvents();return this}});b.ObjectCell=h.default.Cell.extend({className:"object-formatter-cell",render:function e(){this.$el.empty();var t=this.model.get(this.column.attributes.name),r='<dl class="dl-horizontal">',a;for(a in t)l.default.isString(t[a])?r+="<dt>"+a+"</dt><dd>"+t[a]+"</dd>":r+="<dt>"+a+"</dt><dd>"+JSON.stringify(t[a])+"</dd>";r+="</dl>";this.$el.append(r);this.delegateEvents();return this}});b.UniversalIdToUsername=h.default.Cell.extend({formatter:{fromRaw:function e(t){return t.substring(3,t.indexOf(",ou=user"))}},render:function e(){b.UniversalIdToUsername.__super__.render.apply(this);this.$el.attr("title",this.model.get(this.column.get("name")));return this}});b.ClickableRow=h.default.Row.extend({events:{click:"onClick",keyup:"onKeyup"},onKeyup:function e(t){13===t.keyCode&&this.callback&&this.callback(t)},onClick:function e(t){this.callback&&this.callback(t)}});b.TemplateCell=h.default.Cell.extend({className:"template-cell",render:function e(){var t=this.template(this.model);this.$el.html(t);this.rendered&&this.rendered();this.delegateEvents();return this}});b.ClassHeaderCell=h.default.HeaderCell.extend({className:"",render:function e(){b.ClassHeaderCell.__super__.render.apply(this);this.delegateEvents();return this}});b.UriExtCell=h.default.UriCell.extend({events:{click:"gotoUrl"},render:function e(){this.$el.empty();var t=this.model.get(this.column.get("name")),r=this.formatter.fromRaw(t,this.model),a=l.default.isFunction(this.column.get("href"))?this.column.get("href")(t,r,this.model):this.column.get("href");this.$el.append((0,i.default)("<a>",{href:a||t,title:this.title||r}).text(r));if(a){this.$el.data("href",a);this.$el.prop("title",this.title||r)}this.delegateEvents();return this},gotoUrl:function e(t){t.preventDefault();var r=(0,i.default)(t.currentTarget).data("href");g.default.navigate(r,{trigger:true})}});b.FilterHeaderCell=h.default.HeaderCell.extend({className:"filter-header-cell enable-pointer",render:function e(){var t=new h.default.Extension.ThemeableServerSideFilter({name:this.column.get("name"),placeholder:i.default.t("common.form.filter"),collection:this.collection});this.addClassName&&this.$el.addClass(this.addClassName);this.collection.state.filters=this.collection.state.filters?this.collection.state.filters:[];this.collection.state.filters.push(t);b.FilterHeaderCell.__super__.render.apply(this);this.$el.prepend(t.render().el);return this}});b.queryFilter=function(e){void 0===e&&(e={});var t=[],r=e._queryFilter||[],a=function(){return e&&e.filterName&&"eq"===e.filterName?function(e,t){return e+"+eq+"+encodeURIComponent('"*'+t+'*"')}:function(e,t){return e+"+co+"+encodeURIComponent('"'+t+'"')}}();l.default.each(this.state.filters,function(e){""!==e.query()&&t.push(a(e.name,e.query()))});t=t.concat(r);return 0===t.length||t.join("+AND+")};b.parseState=function(e){this.state.totalRecords||(this.state.totalRecords=e.remainingPagedResults+e.resultCount);this.state.totalPages||(this.state.totalPages=Math.ceil(this.state.totalRecords/this.state.pageSize));return this.state};b.pagedResultsOffset=function(){return(this.state.currentPage-1)*this.state.pageSize};b.sortKeys=function(){return 1===this.state.order?"-"+this.state.sortKey:this.state.sortKey};b.sync=function(e,t,r){var a=[],n=["_pageSize","_pagedResultsOffset","_sortKeys"];"*"===r.data._queryId&&true===r.data._queryFilter?n.push("_queryId"):n.push("_queryFilter");l.default.forIn(r.data,function(e,t){l.default.includes(n,t)&&a.push(t+"="+e)});r.data=a.join("&");r.processData=false;r.beforeSend||(r.beforeSend=function(e){e.setRequestHeader("Accept-API-Version","protocol=1.0,resource=1.0")});r.error=function(e){v.default.addMessage({type:v.default.TYPE_DANGER,response:e})};return u.default.sync(e,t,r)};b.parseRecords=function(e){return e.result};b.getQueryParams=function(e){e=e||{};return{_sortKeys:this.sortKeys,_queryFilter:function t(){return b.queryFilter.call(this,e)},pageSize:"_pageSize",_pagedResultsOffset:this.pagedResultsOffset}};b.doubleSortFix=function(e){var t=e.cid,r=e.collection.filter(function(e){return e.cid!==t});l.default.each(r,function(e){e.set("direction",null)})};b.getState=function(e){var t={pageSize:20,sortKey:"name"};e&&"object"===("undefined"===typeof e?"undefined":a(e))&&l.default.extend(t,e);return t};t.default=b},1550:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=r(6);var n=u(a);var l=r(37);var s=u(l);var i=r(63);var o=u(i);function u(e){return e&&e.__esModule?e:{default:e}}var d={};d.decorateURLWithOverrideRealm=function(e){var t=d.getOverrideRealm(),r,a,n;if(t){if(-1!==e.indexOf("realm="))return e;a=e.indexOf("#");if(-1!==a){n=e.slice(a);e=e.slice(0,a)}r=-1===e.indexOf("?")?"?":"&";e=""+e+r+"realm="+t;n&&(e+=n)}return e};d.decorateURIWithRealm=function(e){e=d.decorateURIWithSubRealm(e);e=d.decorateURLWithOverrideRealm(e);return e};d.decorateURIWithSubRealm=function(e){var t=s.default.globalData,r=t&&t.auth?t.auth.subRealm:"",a=r?r+"/":"";t&&t.auth&&(void 0===t.auth.subRealm||null===t.auth.subRealm)&&console.warn("Unable to decorate URI, Configuration.globalData.auth.subRealm not yet set");e=e.replace("__subrealm__/",a);return e};d.getRealm=function(){var e=d.getOverrideRealm()||d.getSubRealm();return"/"===e.substring(0,1)?e.substring(1):e};d.getOverrideRealm=function(){var e=o.default.parseQueryString(o.default.getCurrentQueryString()).realm,t=o.default.parseQueryString(o.default.getCurrentFragmentQueryString()).realm;return e||t};d.getSubRealm=function(){var e=o.default.getCurrentFragment().split("/"),t=e.shift().split("&")[0],r=["login","passwordReset","continuePasswordReset","register","continueRegister"],a;if(t&&n.default.includes(r,t)){a=e.join("/").split("&")[0];a="/"===a.slice(-1)?a.slice(0,-1):a}else a=s.default.globalData.auth.subRealm?s.default.globalData.auth.subRealm:"";return a};d.encodeRealm=function(e){var t=[],r=e.split("/");n.default.each(r,function(e){""!==e&&t.push(encodeURIComponent(e))});return"/"+t.join("/")};t.default=d},1551:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});r(1603);var a=r(6);var n=u(a);var l=r(19);var s=u(l);var i=r(159);var o=u(i);function u(e){return e&&e.__esModule?e:{default:e}}t.default=o.default.RelationalModel.extend({parse:function e(t){n.default.isUrl(t.id)?t=this.resolve(t.id):t.name=t.id;return t},resolve:function e(t){var r={id:t,name:t};s.default.ajax({async:false,dataType:"json",success:function e(t){r.name=t.name;r["icon_uri"]=t.icon_uri},url:t});return r},sync:function e(t,r,a){a.beforeSend=function(e){e.setRequestHeader("Accept-API-Version","protocol=1.0,resource=1.0")};return o.default.Model.prototype.sync.call(this,t,r,a)}})},1552:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});r(1579);var a=r(6);var n=u(a);var l=r(19);var s=u(l);var i=r(1535);var o=u(i);function u(e){return e&&e.__esModule?e:{default:e}}o.default.Extension.ThemeableServerSideFilter=o.default.Extension.ServerSideFilter.extend({events:n.default.extend(o.default.Extension.ServerSideFilter.prototype.events,{"keyup input[type=search]":"keyupSearch"}),keyupSearch:function e(t){t.preventDefault();this.showClearButtonMaybe(t);this.minimumSearchChars&&(0,s.default)(t.target).val().length>=this.minimumSearchChars&&this.search(t)},className:"form-group has-feedback",template:function e(t){return'<input class="form-control input-sm" type="search" '+(t.placeholder?'placeholder="'+t.placeholder+'"':"")+' name="'+t.name+'" '+(t.value?'value="'+t.value+'"':"")+'/><a class="fa fa-times form-control-feedback" data-backgrid-action="clear" role="button" href="#"></a>'}});t.default=o.default.Extension.ThemeableServerSideFilter},1560:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=r(159);var n=i(a);var l=r(1551);var s=i(l);function i(e){return e&&e.__esModule?e:{default:e}}t.default=n.default.RelationalModel.extend({idAttribute:"subject",relations:[{type:n.default.HasMany,key:"scopes",relatedModel:s.default,includeInJSON:n.default.Model.prototype.idAttribute,parse:true}],validate:function e(t){if(!t.subject)return"no subject";if(!t.scopes||!t.scopes.length)return"no scopes"}})},1574:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=r(6);var n=b(a);var l=r(19);var s=b(l);var i=r(159);var o=b(i);var u=r(37);var d=b(u);var c=r(27);var f=b(c);var h=r(168);var p=b(h);var v=r(1581);var m=b(v);var g=r(1551);var y=b(g);function b(e){return e&&e.__esModule?e:{default:e}}t.default=o.default.RelationalModel.extend({fetch:function e(){var t=s.default.Deferred();o.default.RelationalModel.prototype.fetch.call(this,{success:function e(r){t.resolve(r)},error:function e(r,a){t.reject(a)}});return t.promise()},idAttribute:"_id",parse:function e(t){if(!t.policy){t.policy={};t.policy.permissions=[]}t.policy.policyId=t._id;t.scopes=n.default.map(t.scopes,function(e){return{id:e}});return t},relations:[{type:o.default.HasOne,key:"policy",relatedModel:m.default,parse:true},{type:o.default.HasMany,key:"scopes",relatedModel:y.default,includeInJSON:o.default.Model.prototype.idAttribute,parse:true}],toggleStarred:function e(t){var r=n.default.includes(this.get("labels"),t);r?this.set("labels",n.default.reject(this.get("labels"),function(e){return e===t})):this.get("labels").push(t)},urlRoot:""+f.default.host+f.default.context+"/json"+(0,p.default)("/users/"+d.default.loggedUser.get("username")+"/oauth2/resources/sets")})},1575:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});r(1531);var a=r(6);var n=j(a);var l=r(19);var s=j(l);var i=r(114);var o=j(i);var u=r(1535);var d=j(u);var c=r(1546);var f=j(c);var h=r(655);var p=j(h);var v=r(27);var m=j(v);var g=r(59);var y=j(g);var b=r(1550);var _=j(b);var S=r(1582);var C=j(S);var M=r(1560);var R=j(M);var O=r(1551);var x=j(O);var P=r(1574);var E=j(P);function j(e){return e&&e.__esModule?e:{default:e}}var I,U=/[?&]realm=/,$=/\/json\/users\/[^/]+\/uma\/policies/,N=/\/json\/users\/[^/]+\/oauth2\/resourcesets/;s.default.ajaxPrefilter(function(e){($.test(e.url)||N.test(e.url))&&!U.test(e.url)&&_.default.getOverrideRealm()&&(e.url=_.default.decorateURLWithOverrideRealm(e.url))});I=o.default.extend({initialize:function e(){this.parentModel=null},template:"user/uma/views/share/CommonShare",events:{"click input#shareButton":"save"},enableOrDisableShareButton:function e(){var t=this.$el.find("#selectUser select")[0].selectize.getValue().length>0,r=this.$el.find("#selectPermission select")[0].selectize.getValue().length>0;this.$el.find("input#shareButton").prop("disabled",!(t&&r))},onParentModelError:function e(t,r){console.error("Unrecoverable load failure UMAResourceSetWithPolicy. "+r.responseJSON.code+" ("+r.responseJSON.reason+") "+r.responseJSON.message)},onParentModelSync:function e(t){t.get("policy").set("policyId",this.parentModel.id);this.render()},syncParentModel:function e(t){var r=!this.parentModel||t&&this.parentModel.id!==t;if(r){this.stopListening(this.parentModel);this.parentModel=E.default.findOrCreate({_id:t});this.listenTo(this.parentModel,"sync",this.onParentModelSync);this.listenTo(this.parentModel,"error",this.onParentModelError);this.parentModel.fetch()}return r},renderDialog:function e(t,r){var a=this,n=(0,s.default)("<div></div>"),l=t._id||t,i={type:p.default.TYPE_PRIMARY,title:s.default.t("uma.share.shareResource"),size:p.default.SIZE_WIDE,cssClass:"shareDialog",message:n,buttons:[{label:s.default.t("common.form.close"),cssClass:"btn-default",action:function e(t){t.close()}}],onshow:function e(){a.element=n;a.render(l,r)},onshown:function e(){a.renderShareCounter(r)}};this.toBeCreated=t.toBeCreated;this.afterShare=t.share;p.default.show(i)},render:function e(t,r){var a=this,n,l;t instanceof Array&&(t=t[0]);if(this.syncParentModel(t))return;this.data={};this.data.name=this.parentModel.get("name");this.data.icon=this.parentModel.get("icon_uri");this.data.scopes=this.parentModel.get("scopes").toJSON();n=this.parentModel.get("policy").get("permissions");this.data.permissions=n.toJSON();l=new d.default.Grid({columns:[{name:"subject",label:s.default.t("uma.resources.show.grid.0"),cell:"string",editable:false,headerCell:f.default.ClassHeaderCell.extend({className:"col-md-6"})},{name:"scopes",label:s.default.t("uma.resources.show.grid.2"),cell:d.default.Cell.extend({render:function e(){var t=this.model.get("scopes").pluck("name").join(", ");this.$el.empty();this.$el.append(t);this.delegateEvents();return this}}),editable:false,headerCell:f.default.ClassHeaderCell.extend({className:"col-md-6"})}],collection:n,emptyText:s.default.t("console.common.noResults"),className:"backgrid table"});this.parentRender(function(){a.renderUserOptions();a.renderPermissionOptions();a.renderShareCounter(r);a.$el.find("#advancedView").append(l.render().el);a.$el.find("#umaShareImage img").error(function(){(0,s.default)(this).parent().addClass("fa-file-image-o no-image")})})},renderPermissionOptions:function e(){var t=this;this.$el.find("#selectPermission select").selectize({plugins:["restore_on_backspace"],delimiter:false,persist:false,create:false,hideSelected:true,onChange:function e(){t.enableOrDisableShareButton()}})},renderUserOptions:function e(){var t=this;this.$el.find("#selectUser select").selectize({addPrecedence:true,create:true,onChange:function e(r){var a=t.parentModel.get("policy").get("permissions").findWhere({subject:r}),n,l=t.$el.find("#selectPermission select");if(a){n=a.get("scopes").pluck("name");l[0].selectize.focus();l[0].selectize.setValue(n)}t.enableOrDisableShareButton()}})},reset:function e(){this.$el.find("#selectUser select")[0].selectize.clear();this.$el.find("#selectPermission select")[0].selectize.clear();this.$el.find("input#shareButton").prop("disabled",true);this.renderShareCounter()},save:function e(){var t=this;var r=this.parentModel.get("policy").get("permissions"),a=this.$el.find("#selectUser select")[0].selectize.getValue(),l=n.default.each(this.$el.find("#selectPermission select")[0].selectize.getValue(),function(e){return x.default.find({id:e})}),s=[],i;n.default.forEach(a,function(e){var t=R.default.findOrCreate({subject:e,scopes:l});r.add(t);s.push(t)});i=this.parentModel.get("policy");this.toBeCreated&&(i.toBeCreated=this.toBeCreated);i.save().then(function(){y.default.sendEvent(m.default.EVENT_DISPLAY_MESSAGE_REQUEST,"policyCreatedSuccess");t.reset()},function(e){e.status&&500===e.status&&n.default.forEach(s,function(e){r.remove(e)});y.default.sendEvent(m.default.EVENT_DISPLAY_MESSAGE_REQUEST,"policyCreatedFail")}).always(function(){t.toBeCreated=false;t.afterShare&&t.afterShare()})},renderShareCounter:function e(t){var r=this.parentModel.get("policy"),a=r?r.get("permissions").length:0;C.default.render(a,t)}});t.default=I},1581:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=r(6);var n=v(a);var l=r(159);var s=v(l);var i=r(37);var o=v(i);var u=r(27);var d=v(u);var c=r(168);var f=v(c);var h=r(1560);var p=v(h);function v(e){return e&&e.__esModule?e:{default:e}}t.default=s.default.RelationalModel.extend({idAttribute:"policyId",toBeCreated:true,relations:[{type:s.default.HasMany,key:"permissions",relatedModel:p.default}],parse:function e(t){n.default.isEmpty(t.permissions)||(this.toBeCreated=false);return t},sync:function e(t,r,a){a=a||{};a.beforeSend=function(e){e.setRequestHeader("Accept-API-Version","protocol=1.0,resource=1.0")};if("update"===t.toLowerCase()&&true===r.toBeCreated){r.toBeCreated=false;a.headers={};a.headers["If-None-Match"]="*"}r.get("permissions").length||(r.toBeCreated=true);return s.default.Model.prototype.sync.call(this,t,r,a)},urlRoot:""+d.default.host+d.default.context+"/json"+(0,f.default)("/users/"+o.default.loggedUser.get("username")+"/uma/policies")})},1582:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:true});var a=r(19);var n=i(a);var l=r(114);var s=i(l);function i(e){return e&&e.__esModule?e:{default:e}}var o=s.default.extend({template:"user/uma/views/share/ShareCounter",element:"#shareCounter",render:function e(t,r){this.data.shareCount=t;this.data.shareInfo=this.getShareInfo(t);this.data.shareIcon=this.getShareIcon(t);this.parentRender(function(){r&&r()})},getShareInfo:function e(t){var r=t?{count:t}:{context:"none"};return n.default.t("uma.share.info",r)},getShareIcon:function e(t){var r="fa fa-lock";1===t?r="fa fa-user":t>1&&(r="fa fa-users");return r}});t.default=new o}}]);
//# sourceMappingURL=11.d037453af2.js.map