(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15,9,170,171,354],{1169:function(e,t,a){var n=a(62);e.exports=(n["default"]||n).template({1:function(e,t,a,n,l){var r;return null!=(r=e.invokePartial(n["navigation/_TreeNavigationLeaf"],t,{name:"navigation/_TreeNavigationLeaf",hash:{identifier:"side"},data:l,indent:"                                ",helpers:a,partials:n,decorators:e.decorators}))?r:""},3:function(e,t,a,n,l){var r;return null!=(r=e.invokePartial(n["navigation/_TreeNavigationLeaf"],t,{name:"navigation/_TreeNavigationLeaf",hash:{identifier:"top"},data:l,indent:"                        ",helpers:a,partials:n,decorators:e.decorators}))?r:""},compiler:[7,">= 4.0.0"],main:function(e,t,a,n,l){var r,i=null!=t?t:e.nullContext||{};return'<div id="menu" class="menubar"></div>\n\n<div class="subnav-container">\n    <div class="container">\n        <div class="row">\n            <nav class="navbar navbar-default" role="navigation">\n\n                <div id="breadcrumbContent">\n'+(null!=(r=e.invokePartial(n["breadcrumb/_BreadcrumbTitle"],t,{name:"breadcrumb/_BreadcrumbTitle",hash:{title:null!=t?t.title:t},data:l,indent:"                    ",helpers:a,partials:n,decorators:e.decorators}))?r:"")+'                </div>\n\n                <div id="breadcrumbNavBar" class="navbar-collapse collapse">\n                    <nav class="sidenav visible-xs-block">\n                        <ol class="list-unstyled">\n'+(null!=(r=a.each.call(i,null!=t?t.treeNavigation:t,{name:"each",hash:{},fn:e.program(1,l,0),inverse:e.noop,data:l}))?r:"")+'                        </ol>\n                    </nav>\n                </div>\n            </nav>\n        </div>\n    </div>\n</div>\n\n\n<div class="container tree-view-container">\n    <div class="row">\n        <div class="col-sm-3 col-md-3 col-lg-2 hidden-xs">\n            <nav class="sidenav">\n                <ol class="list-unstyled">\n'+(null!=(r=a.each.call(i,null!=t?t.treeNavigation:t,{name:"each",hash:{},fn:e.program(3,l,0),inverse:e.noop,data:l}))?r:"")+'                </ol>\n            </nav>\n        </div>\n\n        <div id="sidePageContent" class="col-sm-9 col-md-9 col-lg-10"></div>\n    </div>\n</div>\n'},usePartial:true,useData:true})},1190:function(e,t,a){var n=a(62);e.exports=(n["default"]||n).template({compiler:[7,">= 4.0.0"],main:function(e,t,a,n,l){return"<select multiple class='selectize'>\n    <option disabled selected value>"+e.escapeExpression((a.t||t&&t.t||a.helperMissing).call(null!=t?t:e.nullContext||{},"common.form.pleaseSelect",{name:"t",hash:{},data:l}))+"</option>\n</select>\n"},useData:true})},1191:function(e,t,a){var n=a(62);e.exports=(n["default"]||n).template({compiler:[7,">= 4.0.0"],main:function(e,t,a,n,l){var r=null!=t?t:e.nullContext||{},i=a.helperMissing,s=e.escapeExpression;return'<div class="btn-group pull-right">\n    <button class="btn btn-link" id="revoke" type="button" title="'+s((a.t||t&&t.t||i).call(r,"common.form.revoke",{name:"t",hash:{},data:l}))+'">\n        <i class="fa fa-trash-o"></i>\n    </button>\n    <button class="btn btn-link" id="save" type="button" title="'+s((a.t||t&&t.t||i).call(r,"common.form.save",{name:"t",hash:{},data:l}))+'">\n        <i class="fa fa-check"></i>\n    </button>\n    <button class="btn btn-link" id="cancel" type="button" title="'+s((a.t||t&&t.t||i).call(r,"common.form.cancel",{name:"t",hash:{},data:l}))+'">\n        <i class="fa fa-close"></i>\n    </button>\n</div>\n'},useData:true})},1561:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=a(6);var l=v(n);var r=a(169);var i=v(r);var s=a(37);var o=v(s);var d=a(27);var u=v(d);var c=a(168);var f=v(c);function v(e){return e&&e.__esModule?e:{default:e}}var h=new i.default(""+u.default.host+u.default.context+"/json");h.getUmaConfig=function(){return h.serviceCall({url:(0,f.default)("/serverinfo/uma"),headers:{"Accept-API-Version":"protocol=1.0,resource=1.0"}}).then(function(e){o.default.globalData.auth.uma=o.default.globalData.auth.uma||{};o.default.globalData.auth.uma.enabled=e.enabled;o.default.globalData.auth.uma.resharingMode=e.resharingMode;return e})};h.unshareAllResources=function(){var e=encodeURIComponent(o.default.loggedUser.get("username"));return h.serviceCall({url:(0,f.default)("/users/"+e+"/oauth2/resources/sets?_action=revokeAll"),headers:{"Accept-API-Version":"protocol=1.0,resource=1.0"},type:"POST"})};h.approveRequest=function(e,t){return h.serviceCall({url:(0,f.default)("/users/"+encodeURIComponent(o.default.loggedUser.get("username"))+"/uma/pendingrequests/"+e+"?_action=approve"),headers:{"Accept-API-Version":"protocol=1.0,resource=1.0"},type:"POST",data:JSON.stringify({scopes:t})})};h.denyRequest=function(e){return h.serviceCall({url:(0,f.default)("/users/"+encodeURIComponent(o.default.loggedUser.get("username"))+"/uma/pendingrequests/"+e+"?_action=deny"),headers:{"Accept-API-Version":"protocol=1.0,resource=1.0"},type:"POST"})};h.labels={all:function e(){return h.serviceCall({url:(0,f.default)("/users/"+encodeURIComponent(o.default.loggedUser.get("username"))+"/oauth2/resources/labels?_queryFilter=true"),headers:{"Accept-API-Version":"protocol=1.0,resource=1.0"}})},create:function e(t,a){return h.serviceCall({url:(0,f.default)("/users/"+encodeURIComponent(o.default.loggedUser.get("username"))+"/oauth2/resources/labels?_action=create"),headers:{"Accept-API-Version":"protocol=1.0,resource=1.0"},type:"POST",data:JSON.stringify({name:t,type:a})})},get:function e(t){return h.serviceCall({url:(0,f.default)("/users/"+encodeURIComponent(o.default.loggedUser.get("username"))+"/oauth2/resources/labels?_queryFilter=true"),headers:{"Accept-API-Version":"protocol=1.0,resource=1.0"}}).then(function(e){return l.default.find(e.result,{_id:t})})},remove:function e(t){return h.serviceCall({url:(0,f.default)("/users/"+encodeURIComponent(o.default.loggedUser.get("username"))+"/oauth2/resources/labels/"+encodeURIComponent(t)),headers:{"Accept-API-Version":"protocol=1.0,resource=1.0"},type:"DELETE"})}};t.default=h},1585:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=a(6);var l=b(n);var r=a(1);var i=b(r);var s=a(35);var o=b(s);var d=a(114);var u=b(d);var c=a(1169);var f=b(c);var v=a(561);var h=b(v);var p=a(63);var m=b(p);function b(e){return e&&e.__esModule?e:{default:e}}var g="#sidePageContent";var C=function e(t){return t.prototype instanceof u.default};var y=function e(t){return t.prototype instanceof i.default.Component||t.WrappedComponent||l.default.isFunction(t)};var L=u.default.extend({template:f.default,partials:{"breadcrumb/_BreadcrumbTitle":"breadcrumb/_BreadcrumbTitle","navigation/_TreeNavigationLeaf":"navigation/_TreeNavigationLeaf"},events:{"click .sidenav a[href]:not([data-toggle]):not([data-event])":"navigateToPage"},findContentElement:function e(){return this.$el.find(g)[0]},findActiveNavItem:function e(t){var a=this.$el.find('.sidenav ol > li > a[href^="#'+t+'"]');if(a.length){var n=a.parent();n.addClass("active");var l=n.parentsUntil(this.$el.find(".sidenav"),"ol.collapse");l.addClass("in").attr("aria-expanded","true").parent().addClass("active")}else{var r=t.split("/");this.findActiveNavItem(r.slice(0,-1).join("/"))}},navigateToPage:function e(){this.renderSidePageContentOnly=true},setElement:function e(t){var a=this;u.default.prototype.setElement.call(this,t);this.route&&this.renderSidePageContentOnly&&this.route.page().then(l.default.bind(function(e){a.renderPage(e,a.args)},this),l.default.bind(function(){throw"Unable to render page for module "+a.route.page},this))},render:function e(t,a){var n=this;this.args=t;var l=this.findContentElement();l&&o.default.unmountComponentAtNode(l);var r=function e(){n.$el.find(".sidenav li").removeClass("active");n.findActiveNavItem(m.default.getCurrentFragment());n.route.page().then(h.default).then(function(e){n.renderPage(e,t)});a&&a()};this.renderSidePageContentOnly?r():this.parentRender(function(){r()})},renderPage:function e(t,a,n){if(C(t)){var l=new t;l.element=g;l.render(a,n);this.delegateEvents()}else{if(!y(t))throw new Error("[TreeNavigation] Unable to determine page type (Backbone or React).");o.default.render(i.default.createElement(t),this.findContentElement())}this.renderSidePageContentOnly=false}});t.default=L},183:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=a(6);var l=v(n);var r=a(19);var i=v(r);var s=a(73);var o=v(s);var d=a(1585);var u=v(d);var c=a(1561);var f=v(c);function v(e){return e&&e.__esModule?e:{default:e}}var h=u.default.extend({template:"user/uma/views/resource/LabelTreeNavigationTemplate",partials:{"uma/_NestedList":"uma/_NestedList"},findActiveNavItem:function e(t){var a=o.default.configuration.routes.umaResourcesMyLabelsResource,n=o.default.currentRoute===a,r=n?l.default.initial(t.split("/")).join("/"):t,i=this.$el.find(".sidenav ol > li > a[href='#"+r+"']"),s;if(i.length){this.$el.find(".sidenav ol").removeClass("in");s=i.parentsUntil(this.$el.find(".sidenav"),"ol.collapse");s.addClass("in").parent().children("span[data-toggle]").attr("aria-expanded","true");i.parent().addClass("active");"false"===i.attr("aria-expanded")&&i.attr("aria-expanded","true")}},navigateToPage:function e(t){this.$el.find(".sidenav li").removeClass("active");(0,i.default)(t.currentTarget).addClass("active");this.renderSidePageContentOnly=true},render:function e(t,a){var n=this,r,i;this.args=t;this.callback=a;f.default.labels.all().then(function(e){l.default.some(e.result,function(e){return"starred"===e.name.toLowerCase()})||f.default.labels.create("starred","STAR");r=l.default.filter(e.result,function(e){return"user"===e.type.toLowerCase()});i=l.default.sortBy(r,function(e){return e.name});n.data.labels={starred:l.default.filter(e.result,function(e){return"starred"===e.type.toLowerCase()}),system:l.default.filter(e.result,function(e){return"system"===e.type.toLowerCase()}),user:i};n.data.nestedLabels=[];l.default.each(n.data.labels.user,function(e){n.addToParent(n.data.nestedLabels,e)});u.default.prototype.render.call(n,t,a)})},addToParent:function e(t,a){if(-1===a.name.indexOf("/")){a.title=a.name;a.children=[];a.viewId=l.default.uniqueId("viewId_");t.push(a)}else{var n=a.name.split("/"),r=n.shift(),i;a.name=n.join("/");i=l.default.find(t,{title:r});if(!i){i={title:r,children:[],viewId:l.default.uniqueId("viewId_")};t.push(i)}this.addToParent(i.children,a)}},addUserLabels:function e(t){var a=this;this.data.nestedLabels=[];this.data.labels.user=l.default.sortBy(t,function(e){return e.name});l.default.each(this.data.labels.user,function(e){a.addToParent(a.data.nestedLabels,e)});this.renderSidePageContentOnly=true;u.default.prototype.render.call(this,this.args,this.callback)}});t.default=new h},605:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=function(){function e(e,t){var a=[];var n=true;var l=false;var r=void 0;try{for(var i=e[Symbol.iterator](),s;!(n=(s=i.next()).done);n=true){a.push(s.value);if(t&&a.length===t)break}}catch(e){l=true;r=e}finally{try{!n&&i["return"]&&i["return"]()}finally{if(l)throw r}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();a(1531);var l=a(6);var r=x(l);var i=a(19);var s=x(i);var o=a(159);var d=x(o);var u=a(114);var c=x(u);var f=a(1535);var v=x(f);var h=a(1546);var p=x(h);var m=a(655);var b=x(m);var g=a(1575);var C=x(g);var y=a(27);var L=x(y);var _=a(59);var P=x(_);var w=a(183);var S=x(w);var T=a(560);var k=x(T);var A=a(1191);var $=x(A);var E=a(1190);var O=x(E);var U=a(1574);var N=x(U);var I=a(1561);var R=x(I);function x(e){return e&&e.__esModule?e:{default:e}}function M(e){return"USER"===e.type}function z(e,t){return r.default.find(e,function(e){return e._id===t})}function B(e,t){return r.default.find(e,function(e){return e.name===t})}function D(e){var t=r.default.map(e,function(e){return R.default.labels.create(e,"USER")});return Promise.all(t).then(function(){return 1===t.length?[arguments[0]._id]:r.default.map(arguments,function(e){return e[0]._id})})}function F(){return R.default.labels.all().then(function(e){return e.result})}var j=c.default.extend({initialize:function e(){this.model=null},template:"user/uma/views/resource/ResourceTemplate",selectizeTemplate:O.default,events:{"click button#starred":"onToggleStarred","click button#share":"onShare","click li#unshare":"onUnshare","click button#editLabels":"editLabels","click .page-toolbar .selectize-input.disabled":"editLabels","click button#saveLabels":"submitLabelsChanges","click button#discardLabels":"discardLabelsChanges"},onModelError:function e(t,a){console.error("Unrecoverable load failure UMAResourceSetWithPolicy. "+a.responseJSON.code+" ("+a.responseJSON.reason+")"+a.responseJSON.message)},onModelChange:function e(t){this.render([void 0,t.get("_id")])},onUnshare:function e(t){if((0,s.default)(t.currentTarget).hasClass("disabled"))return false;t.preventDefault();var a=this;b.default.show({type:b.default.TYPE_DANGER,title:a.model.get("name"),message:s.default.t("uma.resources.show.revokeAllMessage"),closable:false,buttons:[{label:s.default.t("common.form.cancel"),action:function e(t){t.close()}},{id:"btnOk",label:s.default.t("common.form.ok"),cssClass:"btn-primary btn-danger",action:function e(t){t.enableButtons(false);t.getButton("btnOk").text(s.default.t("common.form.working"));a.model.get("policy").destroy().then(function(){P.default.sendEvent(L.default.EVENT_DISPLAY_MESSAGE_REQUEST,"revokeAllPoliciesSuccess");a.onModelChange(a.model);a.model.toBeCreated=true},function(e){k.default.addMessage({response:e,type:k.default.TYPE_DANGER})}).always(function(){t.close()})}}]})},onShare:function e(){var t=this;var a=new C.default;a.renderDialog({_id:this.model.id,toBeCreated:this.model.toBeCreated,share:function e(){t.model.toBeCreated=false;t.updateUnshareButton()}})},onToggleStarred:function e(){var t=this,a=r.default.find(this.allLabels,{type:"STAR"})._id,n=t.$el.find("#starred"),l=n.find("i");t.model.toggleStarred(a);l.removeClass("fa-star-o fa-star");l.addClass("fa-refresh fa-spin");n.attr("disabled",true);t.model.save().always(function(){var e=r.default.includes(t.model.get("labels"),a);n.attr("disabled",false);l.removeClass("fa-refresh fa-spin");l.addClass(e?"fa-star":"fa-star-o")})},renderLabelsOptions:function e(){var t=this,a=this.$el.find("#labels select").selectize({plugins:["restore_on_backspace"],delimiter:false,persist:false,create:true,hideSelected:true,onChange:function e(){t.$el.find("button#saveLabels").prop("disabled",false)},render:{item:function e(t){return'<div data-value="'+t.name+'" class="item">'+t.name+'</div>"'}},labelField:"name",valueField:"name",searchField:["name"]})[0];a.selectize.disable();this.updateLabelOptions();this.$el.find(".page-toolbar .btn-group").hide()},updateLabelOptions:function e(){var t=this.getLabelSelectize(),a=r.default.filter(this.allLabels,M),n=(0,r.default)(this.model.get("labels")).map(r.default.partial(z,this.allLabels)).filter(M).sortBy("name").map("name").value();t.clearOptions();t.addOption(a);t.clear();r.default.each(n,function(e){t.addItem(e)})},renderSelectizeCell:function e(){var t=s.default.Deferred(),a;var n=this.selectizeTemplate({});a=v.default.Cell.extend({className:"selectize-cell",render:function e(){var t;this.$el.html(n);t=this.$el.find("select").selectize({create:false,delimiter:false,dropdownParent:"#uma",hideSelected:true,persist:false,labelField:"name",valueField:"id",items:this.model.get("scopes").pluck("name"),options:this.model.get("scopes").toJSON()})[0];t.selectize.disable();t.selectize.positionDropdown=function(){var e=this.$control,t=this.settings.dropdownParent?e.offset():e.position();if(this.settings.dropdownParent){t.top-=2*e.outerHeight(true)+(0,s.default)(this.settings.dropdownParent).position().top;t.left-=(0,s.default)(this.settings.dropdownParent).offset().left+(0,s.default)(this.settings.dropdownParent).outerWidth()-(0,s.default)(this.settings.dropdownParent).outerWidth(true)}else t.top+=e.outerHeight(true);this.$dropdown.css({width:e.outerWidth(),top:t.top,left:t.left})};this.delegateEvents();return this}});t.resolve(a);return t},render:function e(t,a){var l=r.default.last(t),i=this;if(this.model&&this.id===l)this.isCurrentlyFetchingData||this.renderWithModel(a);else{this.isCurrentlyFetchingData=true;Promise.all([F(),N.default.findOrCreate({_id:l}).fetch()]).then(function(e){var t=n(e,2),l=t[0],r=t[1];if(r.id===i.id){i.allLabels=l;i.model=r;i.isCurrentlyFetchingData=false;i.renderWithModel(a)}},this.onModelError)}this.id=l},renderWithModel:function e(t){var a,n,l,i=this;this.data={};this.data.name=this.model.get("name");this.data.icon=this.model.get("icon_uri");l=p.default.TemplateCell.extend({template:$.default,events:{"click #revoke":"revoke"},revoke:function e(){i.model.get("policy").get("permissions").remove(this.model);i.model.get("policy").save().then(function(){i.onModelChange(i.model)})},className:"fr-col-btn-1"});a=new d.default.Collection;this.model.has("policy")&&(a=this.model.get("policy").get("permissions"));this.renderSelectizeCell().then(function(e){n=new v.default.Grid({columns:[{name:"subject",label:s.default.t("uma.resources.show.grid.0"),cell:"string",editable:false},{name:"permissions",label:s.default.t("uma.resources.show.grid.2"),cell:e,editable:false,sortable:false},{name:"edit",label:"",cell:l,editable:false,sortable:false,headerCell:p.default.ClassHeaderCell.extend({className:"fr-col-btn-1"})}],collection:a,emptyText:s.default.t("console.common.noResults"),className:"backgrid table"});i.parentRender(function(){i.$el.find('[data-toggle="tooltip"]').tooltip();i.renderLabelsOptions();i.updateUnshareButton();i.$el.find(".table-container").append(n.render().el);i.$el.find("#umaShareImage img").error(function(){(0,s.default)(this).parent().addClass("fa-file-image-o no-image")});var e=r.default.find(this.allLabels,{type:"STAR"}),a=r.default.includes(this.model.get("labels"),e._id);a&&i.$el.find("#starred i").toggleClass("fa-star-o fa-star");t&&t()})})},getLabelSelectize:function e(){return this.$el.find("#labels select")[0].selectize},stopEditingLabels:function e(){var t=this.getLabelSelectize();t.disable();this.$el.find(".page-toolbar .btn-group").hide();this.$el.find("#editLabels").show();this.$el.find("#labels .selectize-control").addClass("pull-left")},editLabels:function e(){var t=this.getLabelSelectize();t.enable();t.focus();this.$el.find("#editLabels").hide();this.$el.find("#labels .selectize-control").removeClass("pull-left");this.$el.find("button#saveLabels").prop("disabled",true);this.$el.find("button#discardLabels").prop("disabled",false);this.$el.find(".page-toolbar .btn-group").show()},disableLabelControls:function e(){var t=this.getLabelSelectize();t.disable();this.$el.find("button#saveLabels").prop("disabled",true);this.$el.find("button#discardLabels").prop("disabled",true)},enableLabelControls:function e(){var t=this.getLabelSelectize();t.enable();this.$el.find("button#saveLabels").prop("disabled",false);this.$el.find("button#discardLabels").prop("disabled",false)},submitLabelsChanges:function e(){var t=this,a=this.getLabelSelectize(),l=a.getValue(),i=r.default.filter(this.allLabels,M),s=r.default.map(i,"name"),o=r.default.difference(l,s),d=r.default.intersection(l,s),u=(0,r.default)(d).map(r.default.partial(B,i)).map("_id").value(),c=(0,r.default)(t.model.get("labels")).map(r.default.partial(z,this.allLabels)).reject(M).map("_id").value(),f=u.concat(c);t.disableLabelControls();D(o).then(function(e){t.model.set("labels",f.concat(e));return Promise.all([F(),t.model.save()])}).then(function(e){var a=n(e,1),l=a[0];t.allLabels=l;t.enableLabelControls();t.stopEditingLabels();t.updateLabelOptions();S.default.addUserLabels(r.default.filter(t.allLabels,M))},function(){t.enableLabelControls()})},discardLabelsChanges:function e(){this.stopEditingLabels();this.updateLabelOptions()},updateUnshareButton:function e(){this.model.has("policy")&&this.model.get("policy").get("permissions").length>0&&this.$el.find("li#unshare").removeClass("disabled").find("a").attr("aria-disabled",false)}});t.default=j}}]);
//# sourceMappingURL=15.3d1011a67a.js.map