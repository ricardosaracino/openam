(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[364],{1308:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=a(6);var r=w(n);var i=a(19);var u=w(i);var s=a(657);var d=w(s);var l=a(160);var f=w(l);var o=a(874);var v=w(o);var c=a(875);var p=w(c);var h=a(37);var m=w(h);var b=a(1725);var g=w(b);var k=a(586);var C=w(k);function w(e){return e&&e.__esModule?e:{default:e}}var y=p.default.extend({template:"user/UserProfileKBATab",events:r.default.extend({"change .kba-pair :input":"checkChanges","keyup .kba-pair :input":"checkChanges","mouseup .kba-pair select":"checkChanges","click #provideAnother":"addKBAQuestion","click .delete-KBA-question":"deleteKBAQuestion"},p.default.prototype.events),partials:{"profile/_kbaItem":"profile/_kbaItem"},getTabDetail:function e(){return{panelId:"userKBATab",label:u.default.t("common.user.kba.securityQuestions")}},addKBAQuestion:function e(t){t.preventDefault();var a=this.$el.find("#kbaItems");var n=(0,u.default)(t.target).closest("form");var i=a.find(">li").length;a.append((0,u.default)("<li>").html(f.default.partials["profile/_kbaItem"]({questions:this.data.predefinedQuestions,index:i,isNew:true})));C.default.bindValidators(this.$el.find("form"),m.default.loggedUser.baseEntity,r.default.bind(function(){C.default.validateAllFields(this.$el.find("form"))},this));(0,u.default)(n).find("input[type='reset']").prop("disabled",false)},deleteKBAQuestion:function e(t){var a=(0,u.default)(t.target);var n=a.closest("form");var r=a.closest(".kba-pair");t.preventDefault();"true"===r.attr("isNew")?r.parent("li").remove():r.hide();this.changesPendingWidget.makeChanges({subform:this.getFormContent()});C.default.bindValidators(n,m.default.loggedUser.baseEntity,function(){C.default.validateAllFields(n)});(0,u.default)(n).find("input[type='reset']").prop("disabled",false)},checkChanges:function e(t){var a=(0,u.default)(t.target);var n=a.closest("form");var i=a.closest(".kba-pair");var s=i.find(".answer :input");var l=r.default.keys((0,d.default)(t.target))[0];var f=this.changesPendingWidget.data.watchedObj.subform[l];var o=i.find(".custom-question");var v=a.hasClass("kba-questions");var c=i.find(".kba-questions");var p=false;o.toggleClass("hidden","custom"!==c.val());p=!f||!f[i.attr("index")]||("custom"===c.val()?f[i.attr("index")].customQuestion!==o.find(":input").val():f[i.attr("index")].questionId!==c.val());if(p){s.attr("data-validator","required");s.attr("placeholder","")}(!v||v&&""!==a.val())&&C.default.bindValidators(n,m.default.loggedUser.baseEntity,function(){C.default.validateAllFields(n)});v||this.changesPendingWidget.makeChanges({subform:this.getFormContent()});(0,u.default)(n).find("input[type='reset']").prop("disabled",false)},submit:function e(t){g.default.saveInfo(t).then(r.default.bind(function(){this.submitSuccess()},this))},getFormContent:function e(){var t=this;var a=this.$el.find("form")[0];var n=(0,d.default)(a,".",false);return(0,r.default)(n).map(function(e,n){return r.default.isArray(e)?[n,(0,r.default)(e).map(function(e,i){var s={};if((0,u.default)(a).is(":visible")&&!(0,u.default)(a).find(".kba-pair[index="+i+"]:visible").length)return;e.answer&&e.answer.length?s.answer=e.answer:t.data.user[n]&&r.default.isObject(t.data.user[n][i])&&(s.answer=t.data.user[n][i].answer);"custom"===e.questionId?s.customQuestion=e.customQuestion:s.questionId=e.questionId;return s}).compact().value()]:[n,e]}).fromPairs().value()},render:function e(t,a){this.data=t;g.default.getInfo().then(r.default.bind(function(e){this.data.predefinedQuestions=r.default.map(e.questions,function(e,t){return{id:t,question:e}});this.data.numberOfQuestions=e.minimumAnswersToDefine;this.parentRender(a)},this))},reloadFormData:function e(){var t=this;var a=void 0;this.parentRender(function(){a=t.$el.find("form")[0];(0,v.default)(a,(0,r.default)((0,d.default)(a,".",false)).map(function(e,a){return r.default.isArray(t.data.user[a])?[a,r.default.map(t.data.user[a],function(e){return r.default.omit(e,"answer")})]:[a,t.data.user[a]]}).fromPairs().value());r.default.each((0,u.default)(".kba-questions",a),function(e){var t=(0,u.default)(e).closest(".kba-pair").find(".custom-question");var a=t.find(":input").val();if(""===a)t.toggleClass("hidden",true);else{(0,u.default)(e).val("custom");t.removeClass("hidden")}});t.initializeChangesPending();(0,u.default)(a).find("input[type='reset']").prop("disabled",true);(0,u.default)(a).find("input[type='submit']").prop("disabled",true)})}});t.default=new y},1724:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=a(6);var r=o(n);var i=a(169);var u=o(i);var s=a(37);var d=o(s);var l=a(27);var f=o(l);function o(e){return e&&e.__esModule?e:{default:e}}var v=new u.default(f.default.context+"/"+f.default.SELF_SERVICE_CONTEXT);v.getInfo=function(){return this.serviceCall({url:"kba"})};v.saveInfo=function(e){return this.serviceCall({type:"PATCH",url:"user/"+d.default.loggedUser.id,data:JSON.stringify((0,r.default)(e).map(function(e,t){return{operation:"replace",field:"/"+t,value:e}}))}).then(function(e){return d.default.loggedUser.save(e,{silent:true})})};t.default=v},1725:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:true});var n=a(27);var r=o(n);var i=a(1724);var u=o(i);var s=a(168);var d=o(s);var l=a(81);var f=o(l);function o(e){return e&&e.__esModule?e:{default:e}}var v=void 0;function c(){var e=f.default.getState().local.session.realm;if(e!==v){v=e;var t=(0,d.default)("/"+r.default.SELF_SERVICE_CONTEXT);u.default.serviceUrl=r.default.context+"/json"+t;u.default.baseEntity="json"+t}}c();f.default.subscribe(c);t.default=u.default}}]);
//# sourceMappingURL=364.f6fd6b7079.js.map